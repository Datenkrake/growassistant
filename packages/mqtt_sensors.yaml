mqtt:
  switch:
    - name: "G3V Irrigation Enable (BRAIN)"
      state_topic: "G3D/enable/state/BRAIN"
      command_topic: "G3D/enable/state/BRAIN/set"
      unique_id: mqtt_g3d_enable_brain
      payload_on: "ON"
      payload_off: "OFF"
      value_template: "{{ value }}"

  number:
    ##############################################################################
    #     G1
    ##############################################################################
    - name: "G1 Gantry Position Target"
      unique_id: "g1_gantry_position_target"
      command_topic: "G1/gantry_position_target/state/QBAR/set"
      state_topic: "G1/gantry_position_target/state/QBAR"
      min: 0
      max: 1.30
      step: 0.01
      retain: true

    ##############################################################################
    #     G3D
    ##############################################################################

    - name: "G3D Cycle Start"
      unique_id: "mqtt_g3d_start_date"
      command_topic: "G3D/start_date/state/BRAIN/set"
      min: 0
      max: 9999999999
      step: 1
      retain: true
      unit_of_measurement: "s"

    - name: "G3D Circulation Fan"
      object_id: mqtt_g3d_fan_speed_circulation
      unique_id: mqtt_g3d_fan_speed_circulation
      state_topic: "G3D/fan/speed/CIRCULATION"
      command_topic: "G3D/fan/speed/CIRCULATION/set"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(0)) if (value | float) == (value | float) else 0 }}"

    - name: "G3D Exhaust fan"
      object_id: mqtt_g3d_fan_speed_exhaust
      unique_id: mqtt_g3d_fan_speed_exhaust
      state_topic: "G3D/fan/speed/EXHAUST"
      command_topic: "G3D/fan/speed/EXHAUST/set"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(0)) if (value | float) == (value | float) else 0 }}"

    ######## G3V on G3D
    - name: "G3V Irrigation Duration"
      unique_id: "mqtt_g3d_irrigation_duration"
      command_topic: "G3D/irrigation_duration/state/BRAIN/set"
      min: 0
      max: 100
      step: 1
      retain: true
      unit_of_measurement: "s"

    - name: "G3V Irrigation Period"
      unique_id: "mqtt_g3d_irrigation_duration"
      command_topic: "G3D/irrigation_period/state/BRAIN/set"
      min: 0
      max: 360
      step: 1
      retain: true
      unit_of_measurement: "m"

    ##############################################################################
    #     G3V
    ##############################################################################
    - name: "G3V VPD Target (BRAIN)"
      state_topic: "G3V/vpd_target/state/BRAIN"
      command_topic: "G3V/vpd_target/state/BRAIN/set"
      unique_id: mqtt_g3v_vpd_target_brain
      unit_of_measurement: "kPa"
      value_template: "{{ (value | float | round(2)) if (value | float) == (value | float) else 0 }}"
      min: 0
      max: 2
      step: 0.1
      retain: true

    - name: "G3V Light Percent (BRAIN)"
      state_topic: "G3V/light_percent/state/BRAIN"
      command_topic: "G3V/light_percent/state/BRAIN/set"
      unique_id: mqtt_g3v_light_percent_brain
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      min: 0
      max: 0.70
      step: 0.01
      retain: true

  sensor:
    ##############################################################################
    #     G3D
    ##############################################################################
    - name: "G3D Temperature"
      object_id: mqtt_g3d_temperature
      unique_id: mqtt_g3d_temperature
      state_topic: "G3D/temperature/state/SHT"
      unit_of_measurement: "°C"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true

    - name: "G3D Humidity"
      object_id: mqtt_g3d_humiditiy
      unique_id: mqtt_g3d_humiditiy
      state_topic: "G3D/humidity/state/SHT"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true

    - name: "G3D VPD"
      object_id: mqtt_g3d_vpd
      unique_id: mqtt_g3d_vpd
      state_topic: "G3D/vpd/state/BRAIN"
      unit_of_measurement: "kPa"
      value_template: "{{ (value | float | round(2)) if (value | float) == (value | float) else 0 }}"
      force_update: true

    - name: "G3D Dew Point"
      object_id: mqtt_g3d_dew_point
      unique_id: mqtt_g3d_dew_point
      state_topic: "G3D/dew_point/state/BRAIN"
      unit_of_measurement: "°C"
      value_template: "{{ (value | float | round(2)) if (value | float) == (value | float) else 0 }}"
      force_update: true
    
    - name: "G3D Mains Heater Power"
      object_id: mqtt_g3d_mains_heater_power
      state_topic: "G3D/mains/status/switch:0"
      value_template: "{{ (value_json.apower | float) if (value_json.apower | float) == (value_json.apower | float) else 0 }}"
      unit_of_measurement: "W"
      device_class: power
      force_update: true
      unique_id: mqtt_g3d_mains_heater_power
    

    - name: "G3D Mains Condenser Power"
      object_id: mqtt_g3d_mains_condenser_power
      state_topic: "G3D/mains/status/switch:1"
      value_template: "{{ (value_json.apower | float) if (value_json.apower | float) == (value_json.apower | float) else 0 }}"
      unit_of_measurement: "W"
      device_class: power
      force_update: true
      unique_id: mqtt_g3d_mains_condensor_power
    ##############################################################################
    #     G3V
    ##############################################################################
    - name: "G3V Canopy Temperature"
      object_id: mqtt_g3v_temperature_canopy
      unique_id: mqtt_g3v_temperature_canopy
      state_topic: "G3V/temperature/state/CANOPY"
      unit_of_measurement: "°C"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true

    - name: "G3V Enable (BRAIN)"
      object_id: mqtt_g3v_enable_brain
      unique_id: mqtt_g3v_enable_brain
      state_topic: "G3V/enable/state/BRAIN"
      value_template: "{{ value }}"
      force_update: true

    - name: "G3V Fan Speed (EXHAUST)"
      object_id: mqtt_g3v_fan_speed_exhaust
      unique_id: mqtt_g3v_fan_speed_exhaust
      state_topic: "G3V/fan/speed/EXHAUST"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(0)) if (value | float) == (value | float) else 0 }}"
      force_update: true

    - name: "G3V Fan Speed (HUMIDIFIER)"
      object_id: mqtt_g3v_fan_speed_humidifier
      unique_id: mqtt_g3v_fan_speed_humidifier
      state_topic: "G3V/fan/speed/HUMIDIFIER"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(0)) if (value | float) == (value | float) else 0 }}"
      force_update: true

    - name: "G3V Fan Speed (WIND)"
      object_id: mqtt_g3v_fan_speed_wind
      unique_id: mqtt_g3v_fan_speed_wind
      state_topic: "G3V/fan/speed/WIND"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(0)) if (value | float) == (value | float) else 0 }}"
      force_update: true

    - name: "G3V Canopy Humidity"
      object_id: mqtt_g3v_humidity_canopy
      unique_id: mqtt_g3v_humidity_canopy
      state_topic: "G3V/humidity/state/CANOPY"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true

    - name: "G3V Light Percent (BRAIN)"
      object_id: mqtt_g3v_light_percent_brain
      unique_id: mqtt_g3v_light_percent_brain
      state_topic: "G3V/light_percent/state/BRAIN"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true

    - name: "G3V Mains Heat"
      object_id: mqtt_g3v_mains_heat
      unique_id: mqtt_g3v_mains_heat
      state_topic: "G3V/mains/heat/command/switch:0"
      value_template: "{{ value }}"
      force_update: true

    - name: "G3V RH Target (BRAIN)"
      object_id: mqtt_g3v_rh_target_brain
      unique_id: mqtt_g3v_rh_target_brain
      state_topic: "G3V/rh_target/state/BRAIN"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true

    - name: "G3V Sunrise Time (BRAIN)"
      object_id: mqtt_g3v_sunrise_time_brain
      unique_id: mqtt_g3v_sunrise_time_brain
      state_topic: "G3V/sunrise_time/state/BRAIN"
      value_template: "{{ value }}"
      force_update: true

    - name: "G3V VPD (BRAIN)"
      object_id: mqtt_g3v_vpd_brain
      unique_id: mqtt_g3v_vpd_brain
      state_topic: "G3V/vpd/state/BRAIN"
      unit_of_measurement: "kPa"
      value_template: "{{ (value | float | round(2)) if (value | float) == (value | float) else 0 }}"
      force_update: true

    - name: "G3V VPD Target (BRAIN)"
      object_id: mqtt_g3v_vpd_target_brain
      unique_id: mqtt_g3v_vpd_target_brain
      state_topic: "G3V/vpd_target/state/BRAIN"
      unit_of_measurement: "kPa"
      value_template: "{{ (value | float | round(2)) if (value | float) == (value | float) else 0 }}"
      force_update: true

    ##############################################################################
    #     G2
    ##############################################################################
    - name: "G2 Exhaust Fan Speed"
      object_id: mqtt_g2_fan_speed_exhaust
      state_topic: "G2/fan/speed/EXHAUST"
      unit_of_measurement: "%"
      value_template: "{{ (value | int) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_fan_speed_exhaust

    - name: "G2 Gantry Fan Speed"
      object_id: mqtt_g2_fan_speed_gantry
      state_topic: "G2/fan/speed/GANTRY"
      unit_of_measurement: "%"
      value_template: "{{ (value | int) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_fan_speed_gantry

    - name: "G2 Intake Fan Speed"
      object_id: mqtt_g2_fan_speed_intake
      state_topic: "G2/fan/speed/INTAKE"
      unit_of_measurement: "%"
      value_template: "{{ (value | int) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_fan_speed_intake

    - name: "G2 Humidifier Fan Speed"
      object_id: mqtt_g2_fan_speed_humidifier
      state_topic: "G2/fan/speed/HUMIDIFIER"
      unit_of_measurement: "%"
      value_template: "{{ (value | int) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_fan_speed_humidifier

    - name: "G2 Canopy VPD"
      object_id: mqtt_g2_canopy_vpd
      state_topic: "G2/vpd/state/CANOPY"
      unit_of_measurement: "kPa"
      value_template: "{{ (value | float | round(2)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_canopy_vpd

    - name: "G2 Gantry VPD"
      object_id: mqtt_g2_gantry_vpd
      state_topic: "G2/vpd/state/GANTRY"
      unit_of_measurement: "kPa"
      value_template: "{{ (value | float | round(2)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_gantry_vpd

    - name: "G2 Intake VPD"
      object_id: mqtt_g2_intake_vpd
      state_topic: "G2/vpd/state/INTAKE"
      unit_of_measurement: "kPa"
      value_template: "{{ (value | float | round(2)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_intake_vpd

    - name: "G2 Exhaust VPD"
      object_id: mqtt_g2_exhaust_vpd
      state_topic: "G2/vpd/state/EXHAUST"
      unit_of_measurement: "kPa"
      value_template: "{{ (value | float | round(2)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_exhaust_vpd

    - name: "G2 Canopy Temperature"
      object_id: mqtt_g2_temperature_canopy
      state_topic: "G2/temperature/state/CANOPY"
      unit_of_measurement: "°C"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_temperature_canopy

    - name: "G2 Gantry Temperature"
      object_id: mqtt_g2_temperature_gantry
      state_topic: "G2/temperature/state/GANTRY"
      unit_of_measurement: "°C"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_temperature_gantry

    - name: "G2 Intake Temperature"
      object_id: mqtt_g2_temperature_intake
      state_topic: "G2/temperature/state/INTAKE"
      unit_of_measurement: "°C"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_temperature_intake

    - name: "G2 Exhaust Temperature"
      object_id: mqtt_g2_temperature_exhaust
      state_topic: "G2/temperature/state/EXHAUST"
      unit_of_measurement: "°C"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_temperature_exhaust

    - name: "G2 Canopy Humidity"
      object_id: mqtt_g2_humidity_canopy
      state_topic: "G2/humidity/state/CANOPY"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_humidity_canopy

    - name: "G2 Gantry Humidity"
      object_id: mqtt_g2_humidity_gantry
      state_topic: "G2/humidity/state/GANTRY"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_humidity_gantry

    - name: "G2 Intake Humidity"
      object_id: mqtt_g2_humidity_intake
      state_topic: "G2/humidity/state/INTAKE"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_humidity_intake

    - name: "G2 Exhaust Humidity"
      object_id: mqtt_g2_humidity_exhaust
      state_topic: "G2/humidity/state/EXHAUST"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_humidity_exhaust

    - name: "G2 Canopy DLI"
      object_id: mqtt_g2_dli_canopy
      state_topic: "G2/dli/state/CANOPY"
      unit_of_measurement: "mol/m2/day"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_dli_canopy

    - name: "G2 PPFD Canopy"
      object_id: mqtt_g2_ppfd_canopy
      state_topic: "G2/ppfd/state/CANOPY"
      unit_of_measurement: "μmol/m²/s"
      value_template: "{{ (value | int) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_ppfd_canopy

    - name: "G2 Plant Height"
      object_id: mqtt_g2_height
      state_topic: "G2/gantry/position"
      unit_of_measurement: "cm"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g2_height

    - name: "G2 Gantry Cola Distance"
      object_id: mqtt_g2_cola_distance
      state_topic: "G2/cola_distance/state/CANOPY"
      value_template: "{{ value }}"
      force_update: true
      unique_id: mqtt_g2_cola_distance

    - name: "G2 Gantry Cola Detection"
      object_id: mqtt_g2_cola_detected
      state_topic: "G2/cola_detected/state/CANOPY"
      value_template: "{{ value }}"
      force_update: true
      unique_id: mqtt_g2_cola_detected

    - name: "G2 Irrigation Pump"
      object_id: mqtt_g2_irrigation_pump
      state_topic: "G2/irrigation_pump/state/WATER"
      value_template: "{{ value | bool }}"
      force_update: true
      unique_id: mqtt_g2_irrigation_pump

    - name: "G2 Circulation Pump"
      object_id: mqtt_g2_circulation_pump
      state_topic: "G2/circulation_pump/state/WATER"
      value_template: "{{ value | bool }}"
      force_update: true
      unique_id: mqtt_g2_circulation_pump

    - name: "G2 Mains Light Output"
      object_id: mqtt_g2_mains_light_output
      state_topic: "G2/mains/light/status/switch:0"
      value_template: "{{ value_json.output }}"
      force_update: true
      unique_id: mqtt_g2_mains_light_output

    - name: "G2 Mains Light Power"
      object_id: mqtt_g2_mains_light_power
      state_topic: "G2/mains/light/status/switch:0"
      value_template: "{{ (value_json.apower | float) if (value_json.apower | float) == (value_json.apower | float) else 0 }}"
      unit_of_measurement: "W"
      device_class: power
      force_update: true
      unique_id: mqtt_g2_mains_light_power

    ##############################################################################
    #     G1
    ##############################################################################
    - name: "G1 Exhaust Fan Speed"
      object_id: mqtt_g1_fan_speed_exhaust
      state_topic: "G1/fan/speed/EXHAUST"
      unit_of_measurement: "%"
      value_template: "{{ (value | int) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g1_fan_speed_exhaust

    - name: "G1 Gantry Fan Speed"
      object_id: mqtt_g1_fan_speed_gantry
      state_topic: "G1/fan/speed/GANTRY"
      unit_of_measurement: "%"
      value_template: "{{ (value | int) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g1_fan_speed_gantry

    - name: "G1 Intake Fan Speed"
      object_id: mqtt_g1_fan_speed_intake
      state_topic: "G1/fan/speed/INTAKE"
      unit_of_measurement: "%"
      value_template: "{{ (value | int) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g1_fan_speed_intake

    - name: "G1 Humidifier Speed"
      object_id: mqtt_g1_fan_speed_humidifier
      state_topic: "G1/fan/speed/HUMIDIFIER"
      unit_of_measurement: "%"
      value_template: "{{ (value | int) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g1_fan_speed_humidifier

    - name: "G1 VPD"
      object_id: mqtt_g1_vpd
      state_topic: "G1/vpd/state/CANOPY"
      unit_of_measurement: "kPa"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g1_vpd

    - name: "G1 PPFD"
      object_id: mqtt_g1_ppfd
      state_topic: "G1/ppfd/state/CANOPY"
      unit_of_measurement: "umol/s/m1"
      value_template: "{{ (value | int) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g1_ppfd

    - name: "G1 PROGRESS"
      object_id: mqtt_g1_progress
      state_topic: "G1/schedule_phase_progress/state/CANOPY"
      value_template: "{{ value | string }}"
      force_update: true
      unique_id: mqtt_g1_progress

    - name: "G1 CANOPY TEMPERATURE"
      object_id: mqtt_g1_temperature_canopy
      state_topic: "G1/temperature/state/CANOPY"
      unit_of_measurement: "°C"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g1_temperature_canopy

    - name: "G1 CANOPY HUMIDITY"
      object_id: mqtt_g1_humidity_canopy
      state_topic: "G1/humidity/state/CANOPY"
      unit_of_measurement: "%"
      value_template: "{{ (value | float | round(1)) if (value | float) == (value | float) else 0 }}"
      force_update: true
      unique_id: mqtt_g1_humidity_canopy
